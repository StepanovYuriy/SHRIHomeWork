# SHRIHOMEWORKIII-781 - Инфраструктура

## Общие пояснения к работе

Все файлы, относящиеся к этому домашнему заданию, находятся в папке [`/8-781-Infrastructure`](./)

+ [Описание билд-сервера](./server/README.md)
+ [Описание билд-агента](./agent/README.md)

## Обработка ошибок

В наиболее критичных, на мой взгляд, запросах сделаны повторные запросы:
+ Получение настроек из БД
+ Регистрация агента на билд-сервере

В дальнейшем, возможно, будет увеличено количество попыток и добавлен небольшой интервал между запросами.

## Пояснение к ситуациям описанным в задании

> Сервер должен корректно обрабатывать ситуацию, когда агент прекратил работать между сборками.
`(Пока не реализовано)`

Если при запуске сборки не удалось соединиться с сервером после нескольких попыток, то такой агент удаляется из списка зарегистрированных.
Сборка будет выполнена другим свободным агентом.

Наиболее вероятные причины такой ситуации: 
агент ошибочно или корректно завершил работу.

> Сервер должен корректно обрабатывать ситуацию, когда агент прекратил работать в процессе выполнения сборки.
`(Пока не реализовано)`

При проверке списка билдов на билд-сервере проверяются все агенты со статусом "В работе".
Если не удаётся соединиться с агентом после нескольких попыток, то такой агент завершает свою работу. 
Статус сборки отмечается как "проваленный". 
Агент удаляется из списка зарегистрированных.

Наиболее вероятные причины такой ситуации: 
агент ошибочно или корректно завершил работу.

По-хорошему, ещё надо обработать следующую ситуацию:
Подключение к агенту есть, но сам агент зациклился или выполняется неприлично долго.
Раз в сутки или чаще необходимо удалять таких агентов из списка зарегистрированных.
Однако в такой ситуации очень много нюансов и в рамках этой домашней работы это не требуется.


> Агент должен корректно обрабатывать ситуацию, когда при старте не смог соединиться с сервером.
`(Реализовано)`

Если при старте не удалось соединиться с сервером после нескольких попыток, то такой агент завершает свою работу.

Наиболее вероятные причины такой ситуации: 
не запущен билд-сервер или некорректно выставлены значения в файле конфигурации.

> Агент должен корректно обрабатывать ситуацию, когда при отправке результатов сборки не смог соединиться с сервером.
`(Пока не реализовано)`

Если при отправке результатов не удалось соединиться с сервером после нескольких попыток, то такой агент завершает свою работу.
Результаты сборки также никуда не сохраняются. 
Такие "зависшие" сборки будут обработаны билд-сервером при его запуске и отмечены как "отменённые".
Отмена самим агентом потребует наличие токена для подключения к бд, чего не должно быть по соображениям безопасности.
Сохранение результатов сборки или иных данных в файл для чтения билд-сервером при старте также невозможно, 
т.к. у агента не должно быть доступа к файловой структуре билд-сервера

Наиболее вероятные причины такой ситуации: 
билд-сервер ошибочно или корректно завершил работу.

___

Общий файл [README.md](../README.md) для всех домашних работ.
